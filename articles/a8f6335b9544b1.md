---
title: "ç§ã® Neovim ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ã‚‹"
emoji: "â›„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Neovim", "editor"]
published: false
---

Vim ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚·ãƒªãƒ¼ã‚º2 24æ—¥ç›®ã®è¨˜äº‹ã§ã™ ğŸ„

https://qiita.com/advent-calendar/2023/vim

# ã¯ã˜ã‚ã«

ä»¥å‰ã«ã€Œ2023å¹´ã‚ãŸã—ã® Neovimã€ã¨ã„ã†è¨˜äº‹ã‚’æ›¸ã„ã¦ã‹ã‚‰ã€ã¡ã‚‡ã†ã©åŠå¹´ãã‚‰ã„ãŒçµŒã¡ã¾ã—ãŸã€‚

https://zenn.dev/arrow2nd/articles/aa2605c67efdb0

ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ãŸå½“æ™‚ã¯ã¾ã ç ”ä¿®ä¸­ã§ã—ãŸãŒã€ä»Šã§ã¯ã‚¬ãƒƒãƒ„ãƒªæ¥­å‹™ã§ Neovim ã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ç§ã®ç’°å¢ƒãŒå¤‰ã‚ã£ãŸã‚ˆã†ã« Neovim ã®ç’°å¢ƒã‚‚å¤§ããå¤‰ã‚ã£ã¦ããŸã®ã§ã€ä»Šå›ã¯ãã‚Œã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ãŸ

## Before

![ä»¥å‰](/images/a8f6335b9544b1/neovim_prev.png)

## After

![ä»Š](/images/a8f6335b9544b1/neovim.png)

# å¤–è¦³å‘¨ã‚Š

## ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ ã‚’è‡ªä½œã«

[iceberg.vim](https://github.com/cocopon/iceberg.vim) ã‚’æ„›ç”¨ã—ã¦ã„ãŸã®ã§ã™ãŒã€è‡ªä½œã«ä¹—ã‚Šæ›ãˆã¾ã—ãŸã€‚

https://github.com/arrow2nd/aqua

ä½•ã‹ä¸æº€ãŒã‚ã£ãŸã¨ã‹ã§ã¯ãªãã€ã€Œãªã‚“ã‹è‡ªä½œã—ã¦ã¿ãŸã„ãªï½ã€ã®æ°—æŒã¡ã ã‘ã§ä½œã£ãŸã®ã§ã€ã‹ãªã‚Š iceberg ã‚’ãƒªã‚¹ãƒšã‚¯ãƒˆã—ãŸé…è‰²ã«ãªã£ã¦ã„ã¾ã™ã€‚

æ¿ƒã„æ°´è‰²ã¨å·®ã—è‰²ã®ãƒ”ãƒ³ã‚¯ãŒã‹ã‚ã„ãã¦æ°—ã«å…¥ã£ã¦ã„ã¾ã™ã€‚

![aqua](/images/a8f6335b9544b1/aqua_kawaii.png)

## ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ãƒœãƒ¼ãƒ€ãƒ¼ã‚’ä»˜ã‘ãŸ

ã‚ã£ãŸã‚‰ã‹ã‚ã„ã„ã®ã§ä»˜ã‘ã¾ã—ãŸã€‚

![ãƒœãƒ¼ãƒ€ãƒ¼ã‚ã‚Šã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦](/images/a8f6335b9544b1/border.png)

## listcharsã‚’å¤‰æ›´

ãƒ‘ã£ã¨è¦‹ã§ä½•ãŒä½•ãªã®ã‹åˆ†ã‹ã‚Šã«ãã‹ã£ãŸã®ã§ã€è‰¯ã•ãã†ãªè¨˜å·ã‚’å‰²ã‚Šå½“ã¦ç›´ã—ã¾ã—ãŸã€‚

```diff:option.lua
opt.listchars = {
-   tab = '>>',
+   tab = "â–¸ ",
-   trail = '-',
+   trail = "â‹…",
-   nbsp = '+'
+   nbsp = "â£",
+   extends = "â¯",
+   precedes = "â®"
}
```

# æ©Ÿèƒ½å‘¨ã‚Š

## è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç„¡åŠ¹åŒ–ã§ãã‚‹ã‚ˆã†ã«

ä¿å­˜æ™‚ã«è‡ªå‹•ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒèµ°ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ãŸã®ã§ã™ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ã¯å›°ã‚‹å ´é¢ãŒå‡ºã¦ããŸã®ã§ãƒ‘ã‚¹æŒ‡å®šã§ç„¡åŠ¹åŒ–ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```lua:util.lua
-- è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã§ãã‚‹ã‹
--
-- ç’°å¢ƒå¤‰æ•° `NVIM_DISABLE_AUTOFORMATTING_PROJECTS` ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ç„¡åŠ¹ã«ã§ãã¾ã™
-- ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°æŒ‡å®šå¯èƒ½ã§ã™
local function enable_autoformat()
  local root = vim.fn.getcwd(0)
  local disable_projects = vim.split(os.getenv("NVIM_DISABLE_AUTOFORMATTING_PROJECTS") or "", ",")

  -- ç„¡åŠ¹ã«ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹
  for _, project in ipairs(disable_projects) do
    if root == project then
      return false
    end
  end

  return true
end
```

`enable_autoformat()` ã‚’è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã®æ¡ä»¶ã«å«ã‚ã‚‹ã“ã¨ã§å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

```lua:util.lua
-- ä¿å­˜æ™‚ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
if client.supports_method("textDocument/formatting") and enable_autoformat() then
    local augroup = vim.api.nvim_create_augroup("LspFormatting", { clear = false })
    vim.api.nvim_clear_autocmds({ group = augroup, buffer = bufnr })
    vim.api.nvim_create_autocmd("BufWritePre", {
      callback = function()
        vim.lsp.buf.format({ bufnr = bufnr, timeout_ms = 5000 })
      end,
      group = augroup,
      buffer = bufnr,
    })
end
```

# ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

## ddu.vim

[ddc.vim](https://github.com/Shougo/ddc.vim) ã‚’ä½¿ã„å§‹ã‚ãŸé ƒã‹ã‚‰å­˜åœ¨ã¯çŸ¥ã£ã¦ã„ãŸã®ã§ã™ãŒã€ã¤ã„ã« [telescope.nvim](https://github.com/nvim-telescope/telescope.nvim) ã‹ã‚‰ä¹—ã‚Šæ›ãˆã¾ã—ãŸã€‚
åˆã‚ã¯æ…£ã‚Œãªã‹ã£ãŸã®ã§ã™ãŒã€ä»Šã§ã¯ã™ã£ã‹ã‚Šæ‰‹ã«é¦´æŸ“ã‚“ã§ã„ã¾ã™ã€‚

[Shougo/ddu-ui-ff](https://github.com/Shougo/ddu-ui-ff) ã¨ [Shougo/ddu-ui-filer](https://github.com/Shougo/ddu-ui-filer) ã‚’å°å…¥ã—ã¦ã€ãƒ•ã‚¡ã‚¸ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼å…¼ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://github.com/Shougo/ddu.vim

### ä½¿ã£ã¦ã„ã‚‹ Source ãŸã¡

Telescope ã§è¨€ã†ã¨ã“ã‚ã® Pickers ã«å½“ãŸã‚‹ã‚‚ã®ã§ã™ã€‚
è‰²ã€…å…¥ã‚Œã¦ã„ã¾ã™ã€‚

- [Shougo/ddu-source-file](https://github.com/Shougo/ddu-source-file)
  - ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã®ã‚½ãƒ¼ã‚¹ç”¨
- [matsui54/ddu-source-file_external](https://github.com/matsui54/ddu-source-file_external)
  - `fd` ã‚’ä½¿ã£ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®çµã‚Šè¾¼ã¿ç”¨
- [Shougo/ddu-source-file_old](https://github.com/Shougo/ddu-source-file_old)
  - æœ€è¿‘ä½¿ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«
- [shun/ddu-source-rg](https://github.com/shun/ddu-source-rg)
  - grepæ¤œç´¢ç”¨
- [shun/ddu-source-buffer](https://github.com/shun/ddu-source-buffer)
  - ãƒãƒƒãƒ•ã‚¡æ¤œç´¢
- [matsui54/ddu-source-help](https://github.com/matsui54/ddu-source-help)
  - ãƒ˜ãƒ«ãƒ—æ¤œç´¢
- [uga-rosa/ddu-source-lsp](https://github.com/uga-rosa/ddu-source-lsp)
  - LSPã®ã‚³ãƒ¼ãƒ‰ã‚¸ãƒ£ãƒ³ãƒ—ç”¨
- [Omochice/ddu-source-anyjump](https://github.com/Omochice/ddu-source-anyjump)
  - LSPãŒä½¿ãˆãªã„å ´é¢ã§ã®ã‚³ãƒ¼ãƒ‰ã‚¸ãƒ£ãƒ³ãƒ—ç”¨
  - ä¸€ç•ªæ´»èºã—ã¦ã„ã¾ã™â€¦åœ§å€’çš„æ„Ÿè¬â€¦ğŸ™
- [kyoh86/ddu-source-quickfix_history](https://github.com/kyoh86/ddu-source-quickfix_history)
  - QuickFixã®å±¥æ­´æ¤œç´¢
- [matsui54/ddu-source-command_history](https://github.com/matsui54/ddu-source-command_history)
  - ã‚³ãƒãƒ³ãƒ‰å±¥æ­´æ¤œç´¢
- [Shougo/ddu-source-action](https://github.com/Shougo/ddu-source-action)
  - dduã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠç”¨

## ddc.vim

[Shougo/ddc-source-cmdline](https://github.com/Shougo/ddc-source-cmdline) ã‚’å°å…¥ã—ã¦ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³è£œå®Œã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚

https://github.com/arrow2nd/dotfiles/blob/a5ce4816070d828f11544b3e00a4511cc952b484/.config/nvim/lua/plugins/ddc.lua#L28-L118

`/` ã§æ¤œç´¢ã™ã‚‹ã¨ãã«ã€ãƒãƒƒãƒ•ã‚¡å†…ã®å˜èªãŒè£œå®Œã§ããŸã‚Šã€å…¥åŠ›ä¸­ã«ãƒ˜ãƒ«ãƒ—ãŒè¦‹ã‚‰ã‚ŒãŸã‚Šã™ã‚‹ã®ã§åŠ©ã‹ã£ã¦ã„ã¾ã™ã€‚

![ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³è£œå®Œ](/images/a8f6335b9544b1/ddc_cmdline.png)

## mini.starter

èµ·å‹•æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã§ã™ã€‚
[mini.nvim](https://github.com/echasnovski/mini.nvim) ã«ã„ã¤ã®é–“ã«ã‹å¢—ãˆã¦ãŸã®ã§è¿½åŠ ã—ã¦ã¿ã¾ã—ãŸã€‚

![mini.starter](/images/a8f6335b9544b1/mini-starter.png)

ç›´è¿‘ã«è§¦ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãç›´ã—ãŸã„ã“ã¨ãŒå¤šã€…ã‚ã‚‹ã®ã§ã€é‡å®ã—ã¦ã„ã¾ã™ã€‚

https://github.com/echasnovski/mini.starter

## mini.hipatterns

ã„ã¤ã®é–“ã«ã‹å¢—ãˆã¦ãŸã‚·ãƒªãƒ¼ã‚ºç¬¬2å¼¾ã§ã™ã€‚
[nvim-highlight-colors](https://github.com/brenoprata10/nvim-highlight-colors) ã‹ã‚‰ç§»è¡Œã—ã¾ã—ãŸã€‚

![mini.hipatterns](/images/a8f6335b9544b1/mini-hipatterns.png)

æ©Ÿèƒ½ã¯å°‘ã—æ¸›ã£ãŸã‚‚ã®ã®ã€ç‰¹æ®µä¸è‡ªç”±ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚

https://github.com/echasnovski/mini.hipatterns

## toggleterm

[vim-floaterm](https://github.com/voldikss/vim-floaterm) ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒã€æ©Ÿèƒ½ã‚’æŒã¦ä½™ã—ã¦ã„ã‚‹æ„ŸãŒã‚ã£ãŸã®ã§ç§»è¡Œã—ã¾ã—ãŸã€‚

https://github.com/akinsho/toggleterm.nvim

## efm-langserver

[null-ls](https://github.com/jose-elias-alvarez/null-ls.nvim) ãŒã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚ŒãŸã®ã§ç§»è¡Œã—ã¾ã—ãŸã€‚
Mason çµŒç”±ã§åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://github.com/mattn/efm-langserver

## cspell

Typo è»½æ¸›ã®ãŸã‚ã«è¿½åŠ ã—ã¾ã—ãŸã€‚
ã“ã¡ã‚‰ã¯ efm-langserver çµŒç”±ã§åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://cspell.org/

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨è­¦å‘Šã®ä¸»å¼µãŒå¼·ã„ã®ã§ã€hint æ‰±ã„ã«ã—ã¦ã„ã¾ã™ã€‚

```lua:lsp.lua
  -- cspellãŒå®Ÿè¡Œã§ãã‚‹ãªã‚‰è¿½åŠ 
if vim.fn.executable("cspell") then
    languages["="] = {
      {
        lintCommand = "cspell --no-progress --no-summary --no-color --config=~/.config/cspell/cspell.json ${INPUT}",
        lintIgnoreExitCode = true,
        lintFormats = {
          "%f:%l:%c - %m",
          "%f:%l:%c %m",
        },
        lintSeverity = 4, -- hint
      },
    }
end
```

![cspell](/images/a8f6335b9544b1/hint.png)
_ä¸»å¼µã²ã‹ãˆã‚_

ã¾ãŸã€`:AddCspellLocalDic` `:AddCspellDotfilesDic` ã§å˜èªã‚’è¾æ›¸ã¸è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```lua:commands.lua
-- ãƒ•ã‚¡ã‚¤ãƒ«ã«1è¡Œè¿½åŠ 
local function append_to_file(file, line)
  local f = io.open(file, "a")
  if f == nil then
    print("Error: Cannot open file for writing")
    return
  end

  f:write(line .. "\n")
  f:close()
end

-- ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®å˜èªã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
function WriteWordToFile(file_path)
  local file = file_path

  if file_path:sub(1, 1) == "~" then
    file = vim.uv.os_homedir() .. file_path:sub(2)
  end

  local word = vim.fn.expand("<cword>")

  -- å˜èªã‚’ç·¨é›†ã•ã›ã‚‹
  local input = vim.fn.input("Edit word: ", string.lower(word))
  vim.api.nvim_command("redraw")
  if input == "" then
    print("No word provided. Operation canceled.")
    return
  end

  append_to_file(file, input)

  print("Word '" .. input .. "' has been written to " .. file)
end

-- ãƒ­ãƒ¼ã‚«ãƒ«è¾æ›¸ã«è¿½åŠ 
vim.api.nvim_create_user_command("AddCspellLocalDic", "lua WriteWordToFile('~/.local/share/cspell/user.txt')", {})

-- dotfilesã§ç®¡ç†ã—ã¦ã„ã‚‹è¾æ›¸ã«è¿½åŠ 
vim.api.nvim_create_user_command("AddCspellDotfilesDic", "lua WriteWordToFile('~/.config/cspell/dic.txt')", {})
```

## gp.nvim

ChatGPT ã‚’ä½¿ã†ãŸã‚ã«è¿½åŠ ã—ã¾ã—ãŸã€‚

![gp.nvim](/images/a8f6335b9544b1/gp-nvim.png)

Markdown å½¢å¼ã§å±¥æ­´ãŒæ®‹ã‚‹ã®ã§ã€å¾Œã‹ã‚‰è¦‹è¿”ã—ã‚„ã™ã„ç‚¹ãŒå¥½ãã§ã™ã€‚

https://github.com/Robitx/gp.nvim

# ã•ã„ã”ã«

å¹´æœ«ãªã®ã§ã€ç§ã® Neovim ã®ç’°å¢ƒã®å¤‰åŒ–ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ã¾ã—ãŸã€‚

dotfiles ã®ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’çœºã‚ãªãŒã‚‰è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ãŸã®ã§ã™ãŒã€Neovim ã®è¨­å®šä»¥å¤–ã«ã‚‚å½“æ™‚è©¦è¡ŒéŒ¯èª¤ã—ã¦ã„ãŸæ§˜å­ãŒæ®‹ã£ã¦ã„ã¦ã¨ã¦ã‚‚é¢ç™½ã‹ã£ãŸã§ã™ã€‚

![ãƒ­ã‚°](/images/a8f6335b9544b1/commit_log.png)

ã“ã‚Œã‹ã‚‰ã‚‚å¼•ãç¶šãã€ç›†æ ½ã®ã‚ˆã†ã«è¨­å®šã‚’è‚²ã¦ã¦ã„ããŸã„ã§ã™â€¦ã€‚
