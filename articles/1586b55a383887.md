---
title: "【メモ】Annict の GraphQL API β を使ってみて詰まったところ"
emoji: "📺"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["anime", "graphql", "api", "メモ"]
published: false
---

:::message
記事執筆時点では Annict の GraphQL API は Beta 版という位置付けになっています。

この記事の内容は変更・改善されているかもしれませんので、一度 [リファレンス](https://developers.annict.com/docs) や [ブログ](https://developers.annict.com/blog) で最新の情報を確認することをおすすめします。
:::

# Annict とは

Annict は [shimbaco](https://github.com/shimbaco) さんが開発・運営されている、アニメの視聴記録サービスです。
昔に見た作品を忘れてしまいがちな自分にとって、とても重宝しています 🙏

https://annict.com/

# GraphQL API

GraphQL にあまり馴染みがなかったので勉強ついでに触ってみたところ、いくつか詰まった箇所があったので備忘録を兼ねて書き残しておこうと思います。

## `seasons` に渡す文字列の書式がわからない

### 結論

`YYYY-(spring|summer|autumn|winter)` でした。

> 例: 2005 年 秋 -> "2005-autumn"

### 背景

`seasons` は `searchWorks()` などの作品を取得するクエリで、放送シーズンを指定する際に渡す引数です。

以下のようなクエリで使用します。

```graphql
# 2005年 秋に放送された作品を視聴者数降順で5件取得する
query {
  searchWorks(
    seasons: ["2005-autumn"]
    orderBy: { direction: DESC, field: WATCHERS_COUNT }
    first: 5
  ) {
    nodes {
      title
    }
  }
}
```

定数とかではなく文字列なのでリファレンス上での型は `[String!]` となっており、ぱっと見では形式がわかりませんでした。

色々見て回った後、Annict のシーズン毎のページ URL

```
https://annict.com/works/2005-autumn
```

を見てやっと気づいたのですが、今確認したところ [ドキュメント内の Query のページ](https://developers.annict.com/docs/graphql-api/beta/query) にしれっと載っていました…。

## 未視聴エピソードの取得

### 結論

以下のクエリで取得できました。

```graphql
# 未視聴エピソードとその作品名を取得する
query {
  viewer {
    libraryEntries(states: [WATCHING]) {
      nodes {
        work {
          title
        }
        nextEpisode {
          title
        }
      }
    }
  }
}
```

### 背景

## `searchCharacters` でキャラクターと登場作品名を同時に取得できない

### 結論

### 背景
